<header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50 backdrop-blur-md bg-opacity-90">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <!-- Logo -->
            <a href="/" class="flex items-center gap-2 group">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-yellow-500 to-yellow-700 rounded-lg flex items-center justify-center transform group-hover:rotate-12 transition-transform duration-300 shadow-lg shadow-yellow-500/20">
                    <span class="text-gray-900 font-bold text-xl">C</span>
                </div>
                <span
                    class="text-2xl font-bold text-gray-100 font-display tracking-tight group-hover:text-yellow-500 transition-colors">CardNoble</span>
            </a>

            <!-- Search -->
            <div class="flex-1 max-w-2xl mx-12 hidden md:block">
                <form action="/products" method="GET">
                    <div class="relative group">
                        <div
                            class="absolute -inset-0.5 bg-gradient-to-r from-yellow-600 to-purple-600 rounded-lg blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200">
                        </div>
                        <div class="relative flex">
                            <select name="category"
                                class="px-4 py-2.5 bg-gray-800 border-r border-gray-700 text-gray-300 text-sm rounded-l-lg focus:outline-none focus:bg-gray-700 transition-colors">
                                <option value="">All Categories</option>
                                <% categories.forEach(cat=> { %>
                                    <option value="<%= cat.slug %>">
                                        <%= cat.name %>
                                    </option>
                                    <% }); %>
                            </select>
                            <input type="text" name="q" placeholder="Search for cards, sets, or products..."
                                class="w-full px-5 py-2.5 bg-gray-800 text-gray-100 placeholder-gray-500 rounded-r-lg focus:outline-none focus:bg-gray-700 transition-colors">
                            <button type="submit"
                                class="absolute right-3 top-2.5 text-gray-400 hover:text-yellow-500 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Right Actions -->
            <div class="flex items-center space-x-6">
                <!-- Currency -->
                <div
                    class="flex items-center text-sm font-medium text-gray-400 bg-gray-800 px-3 py-1.5 rounded-full border border-gray-700">
                    <span class="text-yellow-500 mr-2">$</span> USD
                </div>

                <!-- Cart -->
                <a href="/cart" class="relative group p-2">
                    <div
                        class="absolute -inset-2 bg-yellow-500/20 rounded-full blur opacity-0 group-hover:opacity-100 transition duration-300">
                    </div>
                    <svg class="w-6 h-6 text-gray-300 group-hover:text-yellow-400 transition-colors relative"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span id="cart-count"
                        class="absolute -top-1 -right-1 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center shadow-lg border border-gray-900 transform group-hover:scale-110 transition-transform">
                        <%= cartCount %>
                    </span>
                </a>

                <% if (currentUser) { %>
                    <div class="relative group">
                        <button class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors">
                            <div
                                class="w-8 h-8 rounded-full bg-gray-800 border border-gray-700 flex items-center justify-center">
                                <span class="font-bold text-yellow-500">
                                    <%= currentUser.email[0].toUpperCase() %>
                                </span>
                            </div>
                        </button>
                        <!-- Dropdown -->
                        <div
                            class="absolute right-0 mt-4 w-48 bg-gray-800 border border-gray-700 rounded-xl shadow-xl py-2 hidden group-hover:block transform origin-top-right transition-all">
                            <div class="px-4 py-2 border-b border-gray-700 mb-2">
                                <p class="text-sm text-gray-400 truncate">Signed in as</p>
                                <p class="text-sm font-bold text-gray-100 truncate">
                                    <%= currentUser.email %>
                                </p>
                            </div>
                            <% if (currentUser.role==='admin' ) { %>
                                <a href="/admin"
                                    class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Admin
                                    Dashboard</a>
                                <% } %>
                                    <a href="/auth/logout"
                                        class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors">Sign
                                        Out</a>
                        </div>
                    </div>
                    <% } else { %>
                        <a href="/auth/login"
                            class="text-sm font-bold text-gray-300 hover:text-yellow-500 transition-colors">Log In</a>
                        <% } %>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex space-x-8 py-3 text-sm font-medium border-t border-gray-800/50" style="overflow: visible;">
            <a href="/" class="text-yellow-500 whitespace-nowrap border-b-2 border-yellow-500 pb-2">Home</a>

            <!-- Products Dropdown -->
            <div class="relative" id="products-dropdown-wrapper">
                <button id="products-dropdown-btn"
                    class="text-gray-400 hover:text-gray-200 whitespace-nowrap flex items-center pb-2 border-b-2 border-transparent hover:border-gray-600 transition-all">
                    Products
                    <svg class="w-4 h-4 ml-1 opacity-50 transition-transform" id="products-chevron" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>
                <div id="products-dropdown-menu"
                    class="absolute left-0 top-full mt-2 w-64 bg-gray-800 border border-gray-700 rounded-xl shadow-2xl py-3 z-50 hidden">
                    <div class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">Categories</div>
                    <% categories.forEach(category=> { %>
                        <a href="/products?category=<%= category.slug %>"
                            class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white hover:pl-6 transition-all duration-200">
                            <%= category.name %>
                        </a>
                        <% }); %>
                            <div class="border-t border-gray-700 my-2"></div>
                            <a href="/products"
                                class="block px-4 py-2 text-sm text-yellow-500 hover:bg-gray-700 font-bold">View All
                                Products</a>
                </div>
            </div>

            <a href="/sets"
                class="text-gray-400 hover:text-gray-200 whitespace-nowrap pb-2 border-b-2 border-transparent hover:border-gray-600 transition-all">All
                Sets</a>
            <a href="/binders"
                class="text-gray-400 hover:text-gray-200 whitespace-nowrap pb-2 border-b-2 border-transparent hover:border-gray-600 transition-all">Binders</a>
            <a href="/support"
                class="text-gray-400 hover:text-gray-200 whitespace-nowrap pb-2 border-b-2 border-transparent hover:border-gray-600 transition-all">Support</a>
        </nav>

        <script>
            (function () {
                const btn = document.getElementById('products-dropdown-btn');
                const menu = document.getElementById('products-dropdown-menu');
                const chevron = document.getElementById('products-chevron');
                let isOpen = false;

                if (btn && menu && chevron) {
                    btn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        isOpen = !isOpen;
                        menu.classList.toggle('hidden', !isOpen);
                        chevron.style.transform = isOpen ? 'rotate(180deg)' : '';
                    });

                    document.addEventListener('click', function (e) {
                        if (isOpen && !menu.contains(e.target)) {
                            isOpen = false;
                            menu.classList.add('hidden');
                            chevron.style.transform = '';
                        }
                    });
                }
            })();
        </script>
    </div>
</header>